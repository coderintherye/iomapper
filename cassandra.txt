CREATE KEYSPACE IOMapper WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 };
select * from system.schema_keyspaces;

use IOMapper;

drop table mapper;
CREATE TABLE mapper (
  uuid varchar, type varchar, owner varchar, parent varchar, description varchar,
  template varchar,ts timestamp,deleted boolean, name varchar,hwid varchar, 
  properties map<text,text>,
primary key (type,uuid,ts));



drop table io;
CREATE TABLE  io
(host varchar,device varchar,name varchar,uuid varchar,ts timestamp,m_value float,
tag1 varchar,tag2 varchar,tag3 varchar,tag4 varchar,tag5 varchar,tag6 varchar,tag7 varchar,tag8 varchar,
primary key (host,device,name,uuid,ts));

//Get columns for a table:
select column_name from system.schema_columns where keyspace_name='iomapper' and columnfamily_name='io';



CREATE TABLE  io
(template varchar,ts timestamp,html_id varchar,parent_id varchar,bw float,
primary key (template,ts,html_id));

CREATE TABLE  pipes
(type varchar,ts timestamp,html_id varchar,origin varchar, parentB varchar,bwa float, bwb float, stream_id varchar,
primary key (type,ts,html_id))
WITH gc_grace_seconds = 0;

CREATE TABLE sockets
(laddr varchar,lport varchar,raddr varchar,rport varchar,html_id varchar,read int,write int,
primary key (laddr,lport,raddr,rport));

CREATE TABLE ips
(ip varchar,host varchar,html_id varchar,device_name varchar,
primary key (ip,host))
with caching='ALL';

CREATE TABLE clusters
(parent varchar,html_id varchar,name varchar,json varchar,
primary key (parent,html_id))
with caching='ALL';

CREATE TABLE hosts
(host varchar PRIMARY KEY,parent varchar)
with caching='ALL';

CREATE TABLE subnets
(subnet varchar PRIMARY KEY,cluster varchar,cluster_id varchar, parent varchar)
with caching='ALL';

CREATE TABLE containers
(template varchar,parent varchar,html_id varchar,
primary key (template,parent))
with caching='ALL';



//MAYBE make this table timeless, with default TTL at about 24 hours to purge old items
//OR add 'dead' field for agents that aren't responding for a while
CREATE TABLE mapper (
  parent varchar, html_id varchar, template varchar, json varchar,
primary key (parent,html_id)) 
with caching='ALL';


CREATE TABLE  tempio
(type varchar,ts timestamp,host varchar,device_id varchar,uuid varchar,metric_value float,json varchar,
primary key (type,ts,host,device_id,uuid))
WITH CLUSTERING ORDER BY(ts DESC) AND
gc_grace_seconds = 0;


